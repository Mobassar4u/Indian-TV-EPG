name: Generate Indian EPG
on:
  schedule:
    - cron: '0 0,12 * * *' # Runs every 12 hours
  workflow_dispatch:

jobs:
  epg_job:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 18

      - name: Clone EPG Engine
        run: |
          git clone --depth 1 https://github.com/iptv-org/epg.git engine
          cd engine && npm install

      - name: Run Scraper
        run: |
          cp channels.xml engine/channels.xml
          cd engine
          npm run grab -- --channels=channels.xml --output=../epg.xml --days=2

      - name: Compress EPG
        run: gzip -c epg.xml > epg.xml.gz

      - name: Deploy to Branch
        run: |
          git config --global user.name "EPG-Bot"
          git config --global user.email "bot@github.com"
          git add epg.xml epg.xml.gz
          git commit -m "Update EPG: $(date)" || exit 0
          git push